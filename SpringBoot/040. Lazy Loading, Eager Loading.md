# Lazy Loading, Eager Loading

---

## 1. 지연 로딩 (Lazy Loading)

- 정의: 연관된 엔티티를 실제로 사용할 때까지 데이터베이스 조회를 지연시키는 방식이다.
- 지연 로딩을 사용함으로써 연관 엔티티의 데이터를 사용할 필요가 없는 경우, 쿼리 수행과 시간을 절약할 수 있다.
- 
### 사용 방법

```java
// N + 1 문제가 발생할 수 있음
@OneToMany(fetch = fetchType.EAGER)
```

### 사용 시기

- 연관 엔티티를 많이 사용하지 않는 경우
  - 부모 객체를 조회할 때 자식 객체를 따로 조회하지 않고, 자식 객체가 필요한 경우만 로드하여 사용할 때 유용하다.
- 실제로 필요한 경우에만 연관 엔티티를 사용하는 경우
  - 연관 엔티티가 필요한 경우에만 로딩하여  불필요한 쿼리가 수행되지 않아, 쿼리 수행 시간을 줄일 수 있다.
- 대용량 데이터 처리
  - 연관된 엔티티를 무조건 로드하지 않아 불필요한 메모리 사용량을 줄일 수 있다. (특히 대용량 데이터 환경)
- 성능 최적화가 필요한 경우
  - 필요한 경우에만 연관 엔티티를 로딩할 수 있도록 지연 로딩을 사용하여 성능을 최적화할 수 있다.

---

## 2. 즉시 로딩 (Eager Loading)

- 정의: 엔티티를 조회할 때 연관된 모든 엔티티를 즉시 함께 조회하는 방식이다.
- 연관 엔티티를 미리 로딩하여 객체가 사용되기 전에 필요한 데이터를 미리 준비하여, 기본 엔티티를 로딩할 때 연관된 엔티티도 함께 조회한다.
- 즉시 로딩을 과도하게 사용하면 모든 쿼리 결과를 로딩하므로, 모든 데이터에 대해 사용하면 디스크 I/O 및 메모리 사용량이 높아지며 성능 저하 문제가 발생할 수 있다.
- 가급적이면 지연 로딩을 사용하는 것을 권장한다.

### 사용 방법

```java
@OneToMayn(fetch = fetchType.EAGER)
```
### 사용 시기

- 자주 사용되는 연관 엔티티일 때
  - 자주 사용되는 연관 엔티티의 경우에는 미리 로딩하여 사용한다면 쿼리 수행 시간이 감소하므로 유용하다.
- 연관 엔티티의 크기가 작을 때
  - 연관 엔티티의 크기가 작은 경우에는 미리 로딩하여 사용한다면 메모리 효율을 높일 수 있다.

---


## 3. N+1 문제

- Lazy Loading을 사용할 때, 부모 엔티티를 조회한 후 각 자식 엔티티를 조회하는 방식으로 인해 불필요한 쿼리가 다수 발생하는 문제이다.
- 해결 방법
  - FetchType.EAGER 
  - @EntityGraph
  - @BatchSize
  - Fetch Join

---

### 참고자료

[Lazy Loading, Eager Loading](https://hstory0208.tistory.com/entry/JPA-%EC%A7%80%EC%97%B0-%EB%A1%9C%EB%94%A9Lazy-Loading%EA%B3%BC-%EC%A6%89%EC%8B%9C-%EB%A1%9C%EB%94%A9Eager-Loading)