# AWS에 배포하는 방법

---

## 1. AWS 세팅하기

### AWS Region 설정하기

- AWS 콘솔에 로그인 후 리전이 서울로 설정되어 있는지 확인한다. 
- 다른 리전에서 인스턴스를 생성하면 성능이 저하될 수 있기 때문에 서울 리전으로 맞추는 것이 좋다.

### 인스턴스 생성하기

- AWS 콘솔에서 EC2 서비스를 검색하고 EC2 대시보드로 들어간다. 
- 인스턴스 시작 버튼을 클릭하여 인스턴스를 생성한다.
  - EC2 이름: 원하는 이름을 지정한다. (필수는 아니지만 관리 용이)
  - AMI 선택: 사용할 OS를 선택한다. 
  - 인스턴스 유형: 프리티어를 사용한다면 t2.micro를 선택한다. (다른 유형 선택 시 과금이 발생할 수 있다.)

### 키 페어 생성하기

- 키 페어는 EC2 인스턴스에 원격 접속하기 위해 필수적으로 필요하다. 
- 키 페어를 생성하고 파일을 다운로드한 후 안전한 곳에 보관한다. (다시 다운로드할 수 없으므로 주의한다.)

###  네트워크 설정

- 보안 그룹: 인스턴스를 보호하는 방화벽 설정이다. 기본적으로 SSH(22번 포트)만 열려 있다.
    - SSH 트래픽 허용: 외부에서 EC2에 접근할 수 있도록 IP를 설정한다.
    - 0.0.0.0/0을 선택하면 모든 IP에서 접속 가능하게 된다. 보안상 특정 IP로만 접속 허용하는 것이 좋다.

### 스토리지 설정

- 스토리지 용량: 프리티어는 최대 30GB까지 제공된다.
- 볼륨 유형: 기본적으로 범용 SSD를 선택한다. IOPS SSD는 비용이 발생하므로 주의가 필요하다.

### 인스턴스 최종 생성

- 모든 설정을 확인하고 인스턴스 시작을 눌러 인스턴스를 생성한다.

### 보안 그룹 수정하기

- 보안 그룹을 수정하여, 인스턴스에 필요한 포트(8080, 22번 등)를 열어준다.
  - 8080 포트: 스프링 부트 서버가 실행될 포트이다. Anywhere-IPv4로 설정하여 모든 외부에서 접근할 수 있도록 한다.
  - 22번 포트: SSH 접속을 위한 포트이다.
  - HTTP/HTTPS 포트: 웹 애플리케이션을 위해 80번, 443번 포트를 여는 것도 가능하다.

### 보안 그룹 설정 적용

- 생성된 보안 그룹을 EC2 인스턴스에 적용하여 인바운드 규칙이 정상적으로 반영되었는지 확인한다.

---

## 2. SSH 키로 EC2 우분투 콘솔에 접속하기

- SSH 키는 EC2 인스턴스에 접속할 때 사용된다. 
- EC2 대시보드에서 연결 방법을 확인한 후 SSH 클라이언트를 통해 접속합니다.

```bash
chmod 400 sshKey.pem
```

- 권한을 수정한 후, 아래 명령어로 접속한다.

```bash
ssh -i "sshKey.pem" ubuntu@<EC2-Public-DNS>
```

- 접속 성공 후 EC2 우분투 서버의 콘솔에 접속할 수 있다.

---

## 3. 우분투 콘솔에서 Git SSH 연동 후 Git Clone 하기

### Git 설치하기

- Git을 사용하여 프로젝트를 클론한다.

```bash
sudo apt-get install git
git --version
```

### GitHub에서 SSH Key 생성하기

- SSH Key를 생성하여 GitHub와 연결한다.

```bash
cd ~/.ssh
ssh-keygen -t rsa -C "example@github.com"
```

- 생성된 `id_rsa.pub` 파일을 GitHub에 등록한다.
  - GitHub > Settings > SSH and GPG keys > New SSH key
- 생성한 `id_rsa.pub` 파일의 내용을 복사하여 붙여넣습니다.

### Git Clone 하기

- GitHub의 SSH 주소를 복사하여 EC2에서 프로젝트를 클론한다.

```bash
git clone <git-repository-ssh-url>
```

- Yes를 선택하여 SSH 키 인증을 진행하고, 클론이 완료된다.

---

## 4. EC2에서 빌드하고 JAR 파일 실행

### 빌드 파일 생성

- Java 11을 설치하고, Gradle을 사용하여 프로젝트를 빌드한다.

```bash
sudo apt install openjdk-11-jdk
./gradlew build
```
- 빌드가 성공하면 `build/libs` 디렉토리에 JAR 파일이 생성됩니다.

### JAR 파일 실행

- 생성된 JAR 파일을 백그라운드에서 실행한다.

```bash
nohup java -jar <your-application>.jar &
```
- `nohup.out` 파일에 로그가 기록되므로, 해당 파일을 확인하여 실행 상태를 점검한다.
```bash
cat nohup.out
```

### 서버 확인

- EC2의 퍼블릭 DNS나 IP 주소를 복사한 후, 브라우저에서 `http://<EC2-IP>:8080`으로 접속하여 애플리케이션이 정상적으로 동작하는지 확인한다.

---

### 참고자료

[AWS에 배포하는 방법](https://velog.io/@jonghyun3668/SpringBoot-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-EC2-%EB%B0%B0%ED%8F%AC%ED%95%98%EA%B8%B0)