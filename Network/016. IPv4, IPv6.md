# IPv4 vs IPv6

---

## 1. IP

- IP(Internet Protocol)는 OSI 7계층 중 네트워크 계층(3계층)에 해당
- 네트워크 상의 논리적 주소 지정, 데이터 전달 경로 설정 등을 담당

### 주요 특성

1. 비신뢰성 (Unreliable)
    - 데이터그램이 목적지에 도달할 것이라는 보장을 하지 않음
    - 최선의 노력(Best Effort) 방식으로 동작
    - 데이터 손실, 중복, 순서 뒤바뀜 등의 가능성이 존재
    - 신뢰성은 TCP 등 상위 계층에서 제공
2. 비접속형 (Connectionless)
    - 데이터를 전송하기 전 연결을 설정하지 않음
    - 각 데이터그램은 독립적으로 처리되며, 순서 보장 없음
    - 상태 정보를 유지하지 않음 → 낮은 오버헤드, 빠른 처리
3. 주소 지정 (Addressing)
    - 각 노드(기기)는 고유의 IP 주소를 가짐
    - IP 주소는 데이터의 송수신 대상 식별에 사용됨
    - 네트워크 내의 노드를 구분하는 논리적 주소 체계
4. 경로 설정 (Routing)
    - 목적지 주소를 기반으로 데이터 전달 경로를 결정
    - 최적의 경로 선택을 통해 데이터그램 전송
    - 라우터는 이 기능을 수행하며 다양한 경로를 탐색하고 선택

### IP 전송 유형

- Unicast: 단일 호스트를 목적지로 설정하여 전송
- Multicast: 특정 그룹의 호스트들에게 전송 (Class D 사용)
- Broadcast: 동일 네트워크에 있는 모든 호스트에게 전송
    - 브로드캐스트 주소: 호스트 부분이 모두 1 (예: 192.168.1.255)

---

## 2. IP 헤더

- IP 데이터그램의 헤더는 각 필드가 특정한 역할을 가지며, 기본 크기는 옵션이 없을 경우 20바이트 
- 헤더는 빅 엔디안 방식(네트워크 바이트 순서)으로 전송되며, 이는 TCP/IP의 표준 

### 주요 필드

1. 버전 (Version)
    - 현재 사용되는 버전은 4 (IPv4)
    - IPv6는 이후 버전으로 개발됨
2. 헤더 길이 (Header Length)
    - 4비트 필드로, 헤더의 전체 길이를 4바이트 단위로 표현
    - 최소 5 (20바이트), 최대 15 (60바이트)
3. 서비스 유형 (Type of Service, TOS)
    - 3비트의 우선순위, 4비트의 TOS, 1비트 예약
    - TOS는 최소 지연, 최대 처리량, 최대 신뢰성, 최소 비용 중 하나 선택
    - 예: Telnet → 최소 지연, FTP → 최대 처리량, SNMP → 최대 신뢰성
4. 전체 길이 (Total Length)
    - IP 데이터그램 전체 크기 (헤더 + 데이터)
    - 16비트 필드로 최대 65,535 바이트
5. 식별자 (Identification)
    - 데이터그램을 고유하게 식별
    - 단편화된 조각들은 동일한 식별자 값을 가짐
6. 플래그 (Flags)
    - 3비트 구성
        - 1비트: 예약
        - 2비트: 단편화 금지 (DF)
        - 3비트: 더 많은 단편 존재 여부 (MF)
7. 단편화 옵셋 (Fragment Offset)
    - 13비트로 구성, 단편화된 조각의 상대적 위치 표시
    - 데이터그램 재조합 시 사용
8. 단편화 예시
    - 경유 네트워크의 MTU가 작을 경우 데이터그램 단편화 필요
    - DF 비트 설정 시 단편화 불가 → ICMP 에러 메시지 전송
9. 생존 시간 (Time To Live, TTL)
    - 데이터그램이 경유할 수 있는 최대 라우터 수
    - 각 라우터 통과 시 1씩 감소, 0이 되면 폐기 및 ICMP 알림
    - 무한 루프 방지 목적
10. 프로토콜 (Protocol)
    - 상위 계층의 프로토콜 종류 지정
    - TCP: 6, UDP: 17
11. 헤더 체크섬 (Header Checksum)
    - IP 헤더만을 대상으로 한 오류 검출용 필드
    - 수신 시 재계산하여 무결성 확인
    - 오류 발견 시 데이터그램 폐기 (에러 메시지 없음)
12. ARP / RARP
    - ARP (Address Resolution Protocol): IP 주소 → MAC 주소로 변환
    - RARP (Reverse ARP): MAC 주소 → IP 주소로 변환
        - 디스크 없는 시스템이 부팅 시 자신의 IP 주소를 얻는 데 사용

---

## 3. IP 주소

- IP 주소는 네트워크에 연결된 장치가 서로를 식별하고 통신할 수 있도록 고유하게 부여되는 주소
- 32비트 주소를 사람이 읽기 쉬운 형태로 나타내기 위해, 보통 8비트씩 끊어서 10진수로 표시하는 dotted decimal 형식(예: 192.168.0.1)을 사용
- IP 주소는 크게 네트워크 식별자(Netid)와 호스트 식별자(Hostid)로 구성

### IP 주소 클래스

1. Class A
    - 첫 비트: 0
    - Netid: 7비트, Hostid: 24비트
    - 약 16백만 개의 호스트 지원
    - 예: 1.0.0.0 ~ 126.255.255.255
2. Class B
    - 첫 2비트: 10
    - Netid: 14비트, Hostid: 16비트
    - 약 6만 5천 개의 호스트 지원
    - 예: 128.0.0.0 ~ 191.255.255.255
3. Class C
    - 첫 3비트: 110
    - Netid: 21비트, Hostid: 8비트
    - 254개의 호스트 지원
    - 예: 192.0.0.0 ~ 223.255.255.255
4. Class D
    - 첫 4비트: 1110
    - 멀티캐스트 주소로 사용
    - 예: 224.0.0.0 ~ 239.255.255.255
5. Class E
    - 첫 4비트: 1111
    - 실험 및 연구용으로 예약됨
    - 예: 240.0.0.0 ~ 255.255.255.255

### IP 주소 체계의 특징

- Class A: 적은 수의 대형 네트워크 (많은 호스트 수용 가능)
- Class B: 중간 규모의 네트워크
- Class C: 다수의 소규모 네트워크 (중소기업에 적합)
- Class D: 멀티캐스트를 위한 특수 용도
- Class E: 실험적 목적 (일반 네트워크에서 사용되지 않음)


### IP 주소 클래스별 범위 요약

| 클래스 | 시작 주소 범위       | 호스트 수     | 용도             |
|-----|--------------------|----------------|------------------|
| A   | 1.0.0.0 ~ 126.255.255.255 | 약 16,777,214 | 대규모 네트워크 |
| B   | 128.0.0.0 ~ 191.255.255.255| 약 65,534     | 중간 규모 네트워크 |
| C   | 192.0.0.0 ~ 223.255.255.255| 254           | 소규모 네트워크 |
| D   | 224.0.0.0 ~ 239.255.255.255| -             | 멀티캐스트      |
| E   | 127.0.0.0 ~ 127.255.255.255| -             | 루프백 테스트용 |


---

## 3. IPv4의 한계

- IPv4(Internet Protocol version 4)는 1981년 RFC 791을 통해 정의된 인터넷 주소 체계
- 32비트 주소를 사용하며, 최대 약 43억(2³² = 4,294,967,296)개의 IP 주소를 표현할 수 있음
- 그러나 인터넷의 급속한 보급, 무선 인터넷(Wi-Fi, 3G, LTE, 5G 등)과 사물인터넷(IoT)의 확산 등으로 인해 IP 주소 수요가 폭증하면서 IPv4 주소의 고갈 문제가 발생

### 주소 낭비의 원인

- IPv4는 Class A, B, C와 같이 주소를 "네트워크 단위"로 할당하는 구조이기 때문에 실제 필요보다 훨씬 많은 주소를 할당받는 일이 많음  
- 예를 들어, 약 2,000개의 주소가 필요한 기관이 B클래스 주소를 할당받으면 약 6만 개의 주소 중 대부분이 낭비되거나 예비로 남게 됨

### IPv4 주소 현황 (2012~2013년 기준)

- 총 주소 수: 4,294,967,296개
- 할당된 주소: 약 3.41억 개
- 특수 용도: 약 5.88억 개
- 미할당 주소: 약 2.96억 개
- 한국 내 할당 수: 112,231,936개
- 사용률: 99.97%

---

## 4. IPv6의 등장

- IPv4의 한계를 해결하기 위해 차세대 인터넷 프로토콜인 IPv6(IP version 6, RFC 2460)가 등장
- IPv6는 1994년 IETF에 의해 표준화되었으며, 주소 길이를 128비트로 확장하여 약 $3.4 × 10^{38}$개의 주소를 제공
- 이로 인해, 주소 고갈 문제뿐 아니라 다음과 같은 기능적 요구 사항도 충족할 수 있음
  - 보안성 향상
  - 라우팅 효율 개선
  - 품질(QoS) 보장
  - 무선 네트워크 지원

### IPng의 요구사항 (RFC 1726 기반)

- IPng(Internet Protocol Next Generation)는 IPv6 개발을 위한 기술 표준

#### 주요 요구사항

- 범위(Scale)
    - 최소 $10^{12}$개의 종단 시스템 지원
    - $10^9$개의 네트워크 수용 가능
- 토폴로지 유연성
    - 다양한 형태의 네트워크 토폴로지 지원
- 매체 독립성
    - LAN, MAN, WAN 등 다양한 네트워크 매체에서 동작 가능
- 비신뢰성 데이터그램 서비스
    - 신뢰성 없는 데이터 전송 지원 (Best-effort)
- 안전한 동작
    - 해킹, 서비스 거부(DoS), 라우팅 공격 등으로부터 보호
- 고유한 이름
    - 전 세계 어디서든 고유하게 사용 가능한 IP 계층 객체 이름 부여
- 멀티캐스트 지원
    - 유니캐스트 및 멀티캐스트 통신 모두 지원
- 이동성 지원
    - 이동하는 단말 및 네트워크에 대한 지원 가능

---

## 5. IPv6 특징

### 확장된 주소 공간

- 주소 길이: 128비트 (IPv4는 32비트)
- 주소 개수: 약 $3.4 × 10^{38}$ 개
- NAT 불필요: 넉넉한 주소 공간으로 NAT와 같은 주소 절약 기술 불필요
- 주소 형태:
    - 유니캐스트(Unicast): 1:1 통신
    - 애니캐스트(Anycast): 가까운 하나의 노드로 전달
    - 멀티캐스트(Multicast): 여러 수신자에게 동시에 전달
- 자동 주소 생성 기능 내장 (특히 무선 환경에 유리)

### 새로운 헤더 포맷

- 헤더 구조 단순화: 불필요한 필드 제거
- 고정 길이 헤더: 하드웨어 기반 고속 처리 가능
- 확장 헤더 도입: 필요한 경우에만 부가 정보 포함
- 삭제된 필드:
    - 단편화 관련 필드 (식별자, 단편 오프셋 등)
    - 체크섬 필드 (데이터링크 계층에서 처리)
- MTU 경로 탐색: 단편화 대신 사용

### 향상된 서비스 지원 (QoS)

- Flow Label 필드: 트래픽 플로우 식별 가능
- 트래픽 분류: 실시간/비실시간 구분 가능
- 간접적인 QoS 향상: 네트워크 관리 용이

### 보안 기능 내장

- IPSec 기본 내장: IPv4에서는 선택적 설치 필요
- 기능:
    - 인증
    - 데이터 무결성 보호
    - 발신지 확인
    - 종단 간 암호화
- 인터넷 환경 변화에 효과적 대응 가능

### 주소 자동설정

- IPv6는 복잡한 수동 설정 없이도 IP 주소를 자동으로 설정할 수 있음.

#### 방식 1: 상태 보존형 (Stateful)

- DHCPv6 사용
- 서버가 주소 및 설정값 할당
- 장점: 관리 용이, 보안성 높음
- 단점: 서버 설치 및 관리 필요

#### 방식 2: 비상태형 (Stateless)

- 호스트가 스스로 생성
- MAC 주소 + 네트워크 프리픽스 조합
- 장점: 서버 불필요, 자동화 용이
- 단점: 보안 취약점 존재 가능

---

## 6. IPV6 주소

### 주소 표기

- IPv6의 주소는 IPv4와는 달리 16진수로 표시한다. 128비트의 긴 주소를 보다 읽기 쉽게 하기 위해 16진수 콜론 표기법(hexadecimal colon notation)을 사용
- 이것은 128비트를 16비트씩 8개의 필드로 나누어 콜론(:)으로 구분하는데, 각 16비트의 필드는 16진수 값으로 표현

### 주소 생략법

- 16진수로 표현하는 것은 128비트의 긴 주소를 간단히 표현하는데 큰 역할을 하지만 이를 그대로 이용하는 것은 문제점이 존재
- 또한 일부 특정한 유형의 IPv6 주소 할당으로 인하여 주소에는 "0"의 값을 갖는 경우가 많움
- "0"의 값을 포함하는 주소의 작성을 보다 쉽게 하기 위하여 몇 가지 조건하에서 주소를 생략할 수 있는 방법들이 제안됨
  - 각 필드에서 선행하는 0은 생략될 수 있다. 이러한 생략 방식을 사용하면 0221은 221로, 00AB는 AB로, 0000은 0으로 나타낼 수 있다. 
  - 단, 뒤에 나오는 0은 생략할 수 없다. 예를 들어 4200을 42로 생략할 수 없음에 유의해야 한다.
  - 0으로만 나타난 연속된 필드는 0을 모두 삭제하고 2개의 콜론(이중콜론)만으로 나타낸다. 단, 이중콜론 기호는 주소당 한 번만 허용된다. 
  - 이중콜론은 주소 내에서 선행과 후행에 관계없이 사용될 수 있다.
  - IPv4와 IPv6의 주소를 하나의 주소 내에 함께 표현하는 경우가 있는데, 이와 같은 경우에는 하위 32비트를 IPv4 형식으로 주소 표기를 한다. 
  - 즉 x:x:x:x:x:x:d.d.d.d와 같은 표기가 가능하다. 여기서 "x"는 16진수 값을, "d"는 10진수 값을 나타낸다.

### 주소 프리픽스 표현 방법

- IPv6의 주소 프리픽스 표현은 IPv4의 CIDR(Classless Inter-Domain Routing)에서의 표기법과 유사
- IPv6의 주소 뒤에 "/"를 표기하고, 프리픽스의 길이를 나타내는 10진수 숫자를 표기
- 예를 들어 `BEAF::ABCD:0:FFFFFFFFF/70`는 `BEAF::ABCD:0:FFFFFFFFF` 노드의 주소이며, 70비트의 프리픽스를 의미한다. 
- 주의할 점은 /의 앞에 있는 주소 부분은 반드시 IPv6의 주소 표기 방법을 따라야 한다.

### 주소 형태


#### 유니캐스트(Unicast)

- 유니캐스트 주소는 1대1 통신을 함에 있어서 서로 간의 인터페이스를 식별하는 주소
- 유니캐스트 주소는 단일 인터페이스를 지정하며 해당 주소로 보내진 패킷은 해당 인터페이스에만 전달
- IPv4의 유니캐스트 주소는 네트워크, 서브네트워크, 호스트로 구성되었지만, IPv6에서는 주소 공간의 확장으로 보다 많은 계층적 구조를 가질 수 있음
1. 미지정(unspecified) 주소  
   - 주소 0:0:0:0:0:0:0:0 혹은 ::는 미지정 주소
   - 이 주소는 노드가 자신의 주소를 알 수 없을 때 사용
   - 예를 들어, 호스트를 초기화하기 위해 패킷을 전송할 때 자신의 주소를 알지 못하므로, 미지정 주소를 발신지 주소 필드에 사용 
   - 목적지 주소로는 사용할 수 없으며, 어떤 노드에도 할당되지 않음
2. 루프백(loopback) 주소  
   - 주소 0:0:0:0:0:0:0:1 혹은 ::1은 루프백 주소
   - 이 주소는 IPv4의 127.0.0.1과 마찬가지로 자기 자신에게 패킷을 전송할 때 사용
   - 루프백 주소는 호스트의 주소로는 할당될 수 없으며, 패킷이 외부로 전송될 때 발신지 주소로도 사용될 수 없음
3. IPv4 주소를 포함한 IPv6 주소
    - IPv4 호환 주소(IPv4-Compatible Address)
      - IPv6의 네트워크와 IPv4의 네트워크가 동시에 존재하는 경우, IPv6 패킷이 IPv4 네트워크를 경유하고자 할 때 사용
      - 주소의 상위 96비트를 0으로 하고 나머지 32비트를 IPv4 주소로 사용
    - IPv4 매핑 주소(IPv4-Mapped Address)
      - IPv6를 지원하지 않는 호스트를 IPv6 네트워크에서 식별하기 위해 사용
      - 상위 80비트를 0으로, 다음 16비트를 1로 설정하고 나머지 32비트는 IPv4 주소로 구성
4. 글로벌 유니캐스트 주소  
   - 인터넷상의 호스트를 구별할 수 있는 세계적으로 유일한 주소
   - 일반적인 글로벌 유니캐스트 주소는 인터페이스 ID 필드의 크기가 고정되어 있지 않음
     - TLA ID: 라우팅의 계층 구조에서 최상위 식별자이며, IANA에서 관리한다.
     - Res: 향후 확장성을 고려하여 예약된 비트이다.
     - NLA ID: 특정 단위의 사이트를 구별하기 위한 식별자이다.
     - SLA ID: 조직 내부의 서브 네트워크를 구성하기 위한 식별자이다.
5. 로컬 유니캐스트 주소  
   - 글로벌 주소를 절약하고, 보안을 위해 특정 조직(사이트) 내에서만 사용 가능한 주소
   - 인터넷상에서는 사용할 수 없고 로컬 사이트 내에서만 사용

#### 멀티캐스트(Multicast) 주소

- 멀티캐스트 주소는 인터페이스 그룹을 식별하는 주소
- 임의의 멀티캐스트 주소로 패킷을 전송하는 경우, 해당 멀티캐스트 그룹에 등록된 모든 호스트가 패킷을 수신
- 동일한 프리픽스를 공유하지 않거나 동일한 물리적 네트워크에 연결되어 있지 않아도 패킷은 전달
- 멀티캐스트 주소는 상위 8비트가 모두 1로 되어 있으며, 고유한 형식을 가짐
- Flags
  - 4비트로 구성되며, 주소가 영구적인지(0) 또는 일시적인지(1)를 나타냄
  - 상위 3비트는 사용되지 않으며 항상 0이다.
- Scope
  - 멀티캐스트 트래픽이 전달될 수 있는 IPv6 네트워크의 범위를 나타냄
  - 4비트로 구성되며, 값에 따라 노드 로컬, 링크 로컬, 사이트 로컬, 조직 로컬, 글로벌 범위로 구분

공통적으로 사용 가능한 멀티캐스트 주소들은 영구적으로 규정되어 있으며 RFC 2375에 명시되어 있다.

---

## 7. IPv4/IPv6 전환 기술

- IPv6는 기존의 IPv4 주소 부족 문제를 해결하고 보다 향상된 기능을 제공하기 위해 등장하
- 그러나 IPv4 기반 장비가 여전히 대부분이기 때문에 두 프로토콜은 일정 기간 공존할 수밖에 없으며, 이를 위한 다양한 연동 기술이 필요

### 이중 스택 (Dual Stack)

- 개념
  - 하나의 시스템이 IPv4와 IPv6를 동시에 지원하는 구조.
  - IP 계층에 두 프로토콜 스택이 탑재되어 있으며, 상대방에 따라 적절한 프로토콜을 선택함.
- 주소 설정
  - IPv4: DHCP
  - IPv6: Stateless Auto-configuration (SLAAC), 또는 DHCPv6
- DNS 이름 해석
  - IPv4: A 레코드
  - IPv6: AAAA 레코드
  - DNS Resolver Library는 두 유형 모두 지원해야 함.
- 장점
  - 가장 이상적인 전환 방법
  - 기존 및 신규 시스템과 모두 호환
- 단점
  - 장비가 두 개의 스택을 모두 처리해야 하므로 리소스 소모 증가

### 터널링 (Tunneling)

- 개념
  - 한 프로토콜의 패킷을 다른 프로토콜의 패킷 안에 캡슐화하여 전송
  - 일반적으로 IPv6 패킷을 IPv4 패킷 안에 넣어 IPv4 네트워크를 통해 전송
- 분류
  - 설정 터널링 (Configured Tunneling)
    - 고정된 IPv4 주소로 터널 경로 사전 설정
    - 출발지와 목적지 장비가 IPv6 주소를 인식하지 못할 때 사용
    - 예: 6Bone 테스트망
  - 자동 터널링 (Automatic Tunneling)
    - 수동 설정 없이 IPv4 호환 주소를 기반으로 자동 터널 생성
    - 예: 6to4, ISATAP
- 장점
  - 기존 인프라 재활용 가능
  - 구성 유연성 높음
- 단점
  - 캡슐화로 인한 처리 오버헤드
  - 보안 및 관리 측면에서 어려움

### IPv4/IPv6 변환 (Translation)

- 개념
  - 서로 다른 IP 패킷 포맷을 변환하여 통신 가능하게 함
  - IPv4 전용 네트워크와 IPv6 전용 네트워크 간의 통신에 사용
- 분류
  - 네트워크 계층 변환
    - 라우터 수준에서 패킷 헤더 변환
    - 구조 의존성이 높아 다양한 장비에 대한 맞춤 구현 필요
  - 애플리케이션 계층 변환
    - 응용 데이터까지 읽어 변환
    - 다양한 시스템 호환 가능하지만 처리 부하 큼

### NAT-PT (Network Address Translation - Protocol Translation)

- 개요
  - RFC 2766에 정의된 IETF 표준
  - IPv6 노드와 IPv4 노드 간 상호 통신 지원
- 주요 기능:
  1. NAT 기능:
      - IPv6 노드에 IPv4 주소를 동적으로 할당
      - 주소 풀 기반 변환 수행
  2. 헤더 변환:
      - RFC 2765에 정의된 SITT 알고리즘 기반
      - IP/ICMP 헤더 변환을 통해 종단 간 통신 가능
- 장점
  - 전용 네트워크 환경에서도 통신 가능
  - 순수 IPv6 호스트와 IPv4 호스트 간 연결 지원
- 단점:
  - 상태 추적 어려움
  - 성능 및 응용 호환성 문제

---

## 7. IPv4 vs IPv6 비교 요약

| 항목             | IPv4                        | IPv6                            |
|------------------|-----------------------------|----------------------------------|
| 주소 길이        | 32비트                      | 128비트                         |
| 주소 개수        | 약 43억                     | 약 $3.4 × 10^{38}$             |
| 주소 설정 방식   | 수동 또는 DHCP              | 자동설정 (상태/비상태형)       |
| NAT 필요 여부    | 필요                        | 불필요                          |
| 보안 기능        | 옵션 (IPSec 별도 설치)      | 기본 내장                       |
| 헤더 구조        | 복잡, 가변 길이             | 단순, 고정 길이 + 확장 가능     |
| 서비스 품질(QoS) | 제한적 지원                 | 트래픽 분류 기능 내장           |



### 참고자료

[컴퓨터 네트워크](https://search.shopping.naver.com/book/catalog/32497231082?query=%EC%BB%B4%ED%93%A8%ED%84%B0%20%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC&NaPm=ct%3Dm98a6sts%7Cci%3D08f5cabf98b748cd028016de25f32dbe0b5490d9%7Ctr%3Dboksl%7Csn%3D95694%7Chk%3D2df2ba9862a6f7e8dc04a8505129d21be9aac3de)