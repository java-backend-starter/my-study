# VPN

---

## 1. 개요

### 공중 네트워크 (Public Network)

- 공중 네트워크는 전화망이나 인터넷처럼 누구나 자유롭게 접근할 수 있는 네트워크를 의미한다.

#### 장점

- 누구나 어디서든 접속 가능
- 다양한 사용자 간 정보 교환 가능

#### 단점

- 보안에 취약하여 정보 유출 가능성 존재
- 공인된 통신 표준(IP 등)을 따라야 함

### 사설 네트워크 (Private Network)

- 사설 네트워크는 특정 조직 내 사용자만 접근 가능한 폐쇄적인 네트워크이다.

#### 장점

- 인증되지 않은 사용자 접근 제한 → 보안성 우수
- 자체 규칙 적용 가능 → 유연성, 독립성 확보

#### 단점

- 외부 네트워크와 연동이 어려움
- 원거리 연결 시 고비용 발생 (전용회선, WAN 등)
- 이동 사용자 지원이 어려움

---

## 2. VPN 등장 배경 및 정의

- 기업의 네트워크 환경이 확장되면서 본사-지사 간 통신 수요 증가 → 고비용의 전용회선 대체 방안 필요 → VPN 등장

### 정의

- VPN은 공중 네트워크(예: 인터넷)를 이용하여 사설 네트워크처럼 보안성과 기능을 제공하는 가상 네트워크이다.
- VPN은 데이터 암호화, 사용자 인증, 주소 체계 비공개 등을 통해 보안을 유지한다.

### 장점

- ISP가 제공하는 인터넷망을 활용하므로 전용선 대비 비용 절감
- ISP가 있는 지역이라면 어디서든 접속 가능
- 장비 운영/관리를 ISP가 담당 → 관리 비용 절감
- 다양한 구축 방식 제공 (IPSec, MPLS 등)
- 위치에 상관없이 VPN 접속 가능 → 이동성 보장
- 인터넷 구조의 변화와 무관하게 POP만 설정 → 네트워크 유연성 확보

### VPN의 단점

- 명확한 표준 부재 → ISP마다 구현 방식 상이 → 네트워크 연동 문제 발생
- 암호화 기술 유출, 해킹 가능성 등 보안적 취약점 존재
- 인터넷 품질에 따라 VPN 성능도 저하될 수 있음
- QoS 보장 어려움, 관리 복잡성 존재

---

## 3. VPN 구현 기술

- VPN은 다음의 두 가지 핵심 기술을 기반으로 한다.
  - 암호화 기술: 데이터 송수신 시 내용을 암호화하여 타인이 볼 수 없도록 함
  - 터널링 기술: 데이터를 특정 프로토콜로 캡슐화하여 송수신

---

## 4. VPN 제공 기능

VPN은 기존 사설 네트워크가 제공하던 기능을 그대로 제공해야 한다.

- 데이터 기밀성 (Data Confidentiality): 암호화를 통해 타인의 정보 접근 차단
- 데이터 무결성 (Data Integrity): 전송 중 데이터가 변경되지 않았음을 보장
- 데이터 근원 인증 (Data Origin Authentication): 송신자의 신원을 보장
- 접근 통제 (Access Control): 인증된 사용자만 통신 가능하도록 제한


---

## 5. VPN 분류

### 구성 형태에 따른 분류


#### Intranet VPN

- 조직 내부에서만 사용되는 사설 네트워크.
- 인터넷 기반으로 TCP/IP와 동일한 장비 및 응용 프로그램 사용.
- 보안성을 위해 방화벽, ID, 암호 등의 인증 절차 필요.
- 본사와 지사, 또는 부서 간 연결을 위해 사용됨.

#### Extranet VPN

- 고객사나 협력업체 등 외부 조직과의 연결을 위한 VPN.
- Intranet을 확장한 개념.
- 기업 간 데이터 교환이 주 목적.
- 과거 RAS(Remote Access Service)를 이용한 방식은 비용과 설정의 불편함이 있었음.
- 이를 해결하기 위해 등장한 것이 Extranet VPN.

#### Remote Access VPN

- 이동 근무자, 재택근무자 등을 위한 원격 접속 VPN.
- 사용자가 인터넷을 통해 조직 내부 네트워크에 접속.
- 접속 경로: PSTN, ISDN, xDSL, 모바일 인터넷 등.
- 접속 인증, 암호화, 터널링 기능이 중요.
- 언제 어디서나 접속 가능하므로 보안이 핵심.

###  구현에 따른 분류

#### 방화벽 형 VPN (Firewall + VPN)

- 방화벽에 암호화/복호화, 터널링 기능을 추가한 방식.
- 보안성과 통제가 뛰어남.
- 모든 트래픽을 방화벽이 통제하므로 병목현상 발생 가능성 있음.
- 패킷 필터링 기능이 핵심.
  - 필터링 : 접근이 허용되어 있는 이용자들만 통과시키고, 그 밖의 접근에 대해서는 시도하는 모든 사람에 대해서 접근을 차단하는 역할

#### 라우터 형 VPN (Router + VPN)

- 라우터나 접속 서버에 VPN 기능을 추가.
- 소프트웨어 또는 하드웨어 방식으로 구현 가능.
- 대규모 네트워크에서 자주 사용됨.
- 성능은 라우터 자체의 처리 능력에 의존함.

#### VPN 서버 형 (기존 서버 + VPN)

- 메일 서버나 기존 서버에 VPN 기능을 탑재.
- 사용자 인증과 암호화 기능을 제공.
- 구현이 쉽고 비용이 적게 듦.

#### 전용 시스템 VPN

- 별도의 장비를 구축하여 인증, 암호화, 복호화 기능 제공.
- 트래픽 증가에도 안정적인 성능을 보임.
- 확장성 뛰어남.
- 장비 구입 비용이 추가로 필요함.

---

## 6. VPN 구성

- VPN을 구성하기 위해 필수적으로 구현되어야 할 핵심 기술은 터널링, 인증, 암호화이다.

### 터널링

#### 정의

- 터널링은 송신자와 수신자 사이에 외부 침입을 방지하기 위한 논리적 파이프(터널)를 구성하는 기술이다.
- 이때 데이터를 페이로드(Payload)라고 하며, 터널 구간에서는 내용이 변하지 않는다.
- 예: IPv6 ↔ IPv4 간 통신 시에도 사용 가능

#### 터널링 프로토콜 분류

| 프로토콜 | 계층 | 특징 |
|---------|------|------|
| PPTP, L2TP, L2F | 2계층 | Client-to-LAN (Remote Access VPN) |
| IPSec | 3계층 | LAN-to-LAN VPN |
| MPLS | 2/3계층 | 둘 다 지원 가능 |

### 2계층 터널링 프로토콜

#### 특징

- PPP 기반의 Client-Server 모델
- 보안성은 있으나 암호화는 미흡
- ATM, Frame Relay 지원

#### 클라이언트 개시 VPN (Client-Initiated VPN)

- 사용자 장비에 VPN 소프트웨어 필요
- 소규모 네트워크에서 사용
- NAS는 터널링 프로토콜에 관여하지 않음
- PPTP 사용

- 접속 절차
  1. 사용자가 NAS에 접속 (PSTN, ISDN, xDSL 등 이용)
  2. NAS에서 사용자 인증 수행
  3. 사용자가 게이트웨이와 터널 설정

#### NAS 개시 VPN (NAS-Initiated VPN)

- 사용자는 별도 소프트웨어 불필요
- NAS가 인증 및 터널링 프로토콜 수행
- 다수 사용자 동시 접속 가능
- 대규모 네트워크에 적합
- L2F, L2TP 사용

#### PPTP

- Microsoft 개발
- PPP 확장
- IP, IPX, NetBEUI 등을 암호화 후 IP로 캡슐화
- TCP 기반, 윈도우 NT 기반 서버 요구
- 단점: 1:1 연결만 가능

#### L2F

- Cisco 제안
- NAS-Initiated 방식
- 다자간 연결 지원
- UDP 기반

#### L2TP

- PPTP + L2F 통합
- MS와 Cisco 공동 제안
- IPSec 기반 암호화 가능
- UDP 기반
- X.25, Frame Relay, ATM 지원

### 3계층 터널링 프로토콜

#### 특징

- LAN-to-LAN 모델
- 링크 계층 독립적
- 높은 보안성
- CPE에 별도 설치 불필요
- 대표 프로토콜: IPSec, MPLS

---

## 7. IPSec

### 개요

- IETF에서 제안된 IP 계층 보안 프로토콜
- AH와 ESP로 인증, 무결성, 기밀성 제공
- 키 관리는 ISAKMP/IKE가 담당

### 사용 방식

- 호스트 ↔ 호스트
- 게이트웨이 ↔ 게이트웨이
- 게이트웨이 ↔ 호스트

### IPSec 모드

| 모드 | 설명 |
|------|------|
| 전송모드 (Transport Mode) | IP Payload만 암호화 |
| 터널모드 (Tunnel Mode) | IP 전체 패킷 암호화 (라우터 간 암호화) |

### IPSec 헤더 구성

- AH (Authentication Header): 송신자 인증 및 무결성 보장 (암호화 없음)
- ESP (Encapsulating Security Payload): 페이로드 암호화 (기밀성 제공)

> 터널링된 패킷에서는 두 개의 IP 헤더 존재:
> - 외부 IP 헤더: 라우팅 용
> - 내부 IP 헤더: 원래 패킷 정보

---

## 7. VPN 보안

- VPN의 보안은 최근 IPSec의 도입으로 발전을 이루었다. 
- MPLS는 트래픽 엔지니어링 등 강력한 기능을 제공하지만, 보안에 있어서는 부족한 면이 있다. 
- 이를 해결하기 위해 IPSec을 사용한 VPN 구성이 활발히 이루어지고 있다.

### IPSec

- IPSec은 IETF에서 IP 계층 보안을 위해 설계된 표준으로 네트워크 계층에서 보안을 제공하며 상위 계층의 변경 없이 보안 서비스를 제공한다. 
- IPSec은 암호화 알고리즘을 수용하며, IPv6에서는 기본적으로 포함된다. 
- IPSec이 제공하는 주요 기능은 다음과 같다:
  - 데이터 원본 인증: 데이터가 원본에서 왔는지 확인.
  - 데이터 무결성: 데이터가 이동 중에 변경되지 않았음을 보장.
  - 데이터 기밀성: 암호화로 메시지의 내용을 숨김.
  - Replay 보호: 데이터의 재전송 공격을 방지.
- IPSec은 공개키 암호화 방식을 사용하고, 암호화와 인증에 관한 정보를 포함한 Security Association(SA)을 통해 설정된다. 
- SA는 양방향 통신을 위해 각각 설정된다.

### IPSec 구성 프로토콜

- AH (Authentication Header): 송신자의 인증 및 데이터 무결성을 제공.
- ESP (Encapsulation Security Payload): 송신자의 인증, 데이터 암호화 및 무결성 제공.
- ISAKMP (Internet Security Association and Key Management Protocol): 키 교환과 SA 관리를 위한 프로토콜.

### 인증 헤더 (AH)

- AH는 IP 패킷에 대해 무결성, 데이터 원본 인증, 그리고 Replay 보호를 제공한다. 
- AH는 전송모드와 터널모드로 작동하며, 각 모드는 보호하는 범위가 다르다.
  - 전송모드: IP 헤더의 일부를 제외한 패킷 전체에 대해 인증 제공.
  - 터널모드: IP 헤더와 페이로드 전체에 대해 인증 제공.

### 캡슐 보안 페이로드 (ESP)

- ESP는 데이터 기밀성, 무결성, 원본 인증 및 Replay 보호를 제공한다. 
- AH와 달리, ESP는 암호화를 제공한다. 
- ESP는 전송모드와 터널모드에서 모두 사용되며, 암호화하는 범위가 다르다.
  - 전송모드: IP 페이로드만 암호화.
  - 터널모드: IP 헤더와 페이로드 전체를 암호화.
- ESP는 AH와 함께 사용할 수 있으며, 보안이 필요한 통신에 대해 인증과 암호화를 제공한다.

### IPSec 데이터 포맷

- AH 프로토콜: AH는 HMAC-MD5 또는 HMAC-SHA-1을 사용하여 MAC값과 일련번호를 포함한다.
- ESP 프로토콜: ESP는 IP 헤더와 페이로드를 암호화하며, 전송모드와 터널모드에서의 동작 방식이 다르다.

### 전송모드 vs 터널모드

- 전송모드: 고유 IP 헤더를 유지하며, ESP나 AH로 암호화된 페이로드만 보호.
- 터널모드: 새로운 IP 헤더를 만들어서 IP 헤더와 페이로드를 모두 암호화하여 보안 게이트웨이를 통한 통신에 사용.


---

## 8. MPLS VPN.

### MPLS (Multi-Protocol Label Switching)

- MPLS는 시스코사의 태그 스위칭과 IBM의 ARIS(Aggregate Route-based IP Switching)를 결합한 IETF 표준이다. 
- MPLS는 기존 스위칭 기술의 문제를 해결하고자 만들어졌으며, 패킷에 MPLS 레이블을 추가하고, 레이블을 기반으로 스위칭한다. 
- 패킷은 MPLS 네트워크 내에서 레이블을 기준으로 전달되고, 최종 라우터에서는 3계층 주소를 사용해 라우팅된다.

### MPLS의 특징

- MPLS 데이터 포맷: 다양한 프로토콜을 지원, 네트워크 환경에 따라 포맷이 달라질 수 있다.
- ATM과의 관계: MPLS는 ATM의 VCI/VPI 필드를 대체, ATM의 의미를 제거한다.
- 2.5계층 프로토콜: 레이블이 2계층과 3계층 사이에서 사용되어 혼란스러울 수 있다.

### MPLS VPN (Multi-Protocol Label Switching VPN)

- MPLS 네트워크를 이용하여 VPN을 제공하는 서비스이다. 
- 다른 VPN 구조에 비해 서비스 도입과 운영 관리가 간단하고, 저가로 VPN 서비스를 제공할 수 있다. 
- MPLS VPN은 RFC2547에 기반하여 개발되었으며, 초기 구축 비용이 적고, 통신 사업자가 모든 장비와 운영 인력을 지원한다.
- 터널링 기능과 링크 계층 프로토콜 지원을 통해 기존 IP 네트워크의 비효율적인 라우팅과 속도를 개선한 기술이다

### MPLS VPN의 특징

- 기존 인터넷에 그대로 적용 가능.
- 2계층 스위칭과 3계층 라우팅 기능을 접목.
- 고정된 4byte 레이블을 사용하여 스위칭.
- 레이블 스와핑을 통해 패킷 포워딩.
- 짧은 패킷 지연 시간, 레이블은 LER(Label Edge Router)에서만 부여.
- 네트워크 라우터와 스위치의 부담을 덜어주고 다양한 서비스 제공(QoS, VoIP, TE 등).
- 가입자에게 일정한 대역폭을 할당, 높은 서비스 수준 지원.
- 사설주소 체계(RFC1918) 지원.

### 장단점

- MPLS VPN은 터널링 기능을 지원한다.
- LER에서 레이블을 부여한 패킷은 MPLS 네트워크 내에서 침입을 방지하며 안전하게 전달된다. 
- 그러나 IPSec VPN에 비해 암호화 기능이 부족한 단점이 있다.

### TE (Traffic Engineering)

- 기존 라우팅 프로토콜은 최단 경로만을 찾지만, 트래픽이 집중되는 경로를 우회시키는 방법을 TE라고 한다. 
- MPLS는 TE 기능을 통해 트래픽을 효율적으로 분산시킨다.

### SSL VPN

- SSL VPN은 이동 근무자들이 별도의 소프트웨어 없이 안전하게 접속할 수 있도록 제공된다. 
- SSL 프로토콜과 TLS(Transport Layer Security)를 사용하여, 사용자와 장비 간의 안전한 데이터 통신을 보장한다. 
- SSL VPN은 IP 계층에서 동작하는 IPSec과 달리 TCP와 애플리케이션 계층 사이에서 동작한다. 
- SSL VPN은 다양한 환경에서 별도의 소프트웨어 설치 없이 사용이 가능하다.

---
### 참고자료

[컴퓨터 네트워크](https://search.shopping.naver.com/book/catalog/32497231082?query=%EC%BB%B4%ED%93%A8%ED%84%B0%20%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC&NaPm=ct%3Dm98a6sts%7Cci%3D08f5cabf98b748cd028016de25f32dbe0b5490d9%7Ctr%3Dboksl%7Csn%3D95694%7Chk%3D2df2ba9862a6f7e8dc04a8505129d21be9aac3de)