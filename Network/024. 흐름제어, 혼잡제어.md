# 흐름제어, 혼잡제어

---

## 1. 흐름제어 (Flow Control)

- 흐름제어는 송신측과 수신측 간의 데이터 처리 속도 차이를 해결하기 위한 기법
- 수신측이 수용할 수 있는 데이터량을 초과하지 않도록, 송신측이 전송 속도를 조절
- 이는 수신측이 자신의 상태를 송신측에 피드백하는 방식으로 이루어진다.

### 문제 상황

- 송신측의 전송량 > 수신측의 처리량일 경우, 수신측의 큐가 넘쳐 패킷 손실이 발생할 수 있다. 
- 손실된 데이터의 재전송은 전체적인 전송 효율을 떨어뜨린다.

### 흐름제어 기법

1. Stop and Wait
   - 송신측은 하나의 패킷을 전송하고, 수신측의 ACK(확인 응답)를 받은 후 다음 패킷을 전송한다.
   - 구조가 단순하지만, 매번 ACK를 기다려야 하므로 비효율적이다.
2. Sliding Window
   - 수신측에서 설정한 윈도우 크기만큼 송신측은 여러 패킷을 연속적으로 전송할 수 있다.
   - 수신측은 수용 가능한 버퍼 크기를 송신측에 알려주고, 송신측은 이에 따라 전송 범위를 설정한다.
   - Window는 전송과 수신 양측 버퍼의 범위를 의미하며, Sliding Window는 윈도우 범위를 옮겨가며 데이터를 전송한다.
   - 송신측과 수신측 모두 각자의 송신 윈도우, 수신 윈도우를 유지하며, 3-way handshaking을 통해 윈도우 크기를 조정한다.

---

## 2.혼잡제어 (Congestion Control)

- 혼잡제어는 송신측과 네트워크(특히 라우터) 간의 데이터 처리 속도 차이를 해결하기 위한 기법
- 네트워크 혼잡이 발생하면 라우터가 데이터를 처리하지 못하고 패킷 손실이 발생하며, 송신측은 재전송하게 된다. 
- 이로 인해 혼잡이 가중될 수 있으므로, 송신측은 전송 속도를 조절해야 한다.

### 혼잡제어 기법

1. AIMD (Additive Increase / Multiplicative Decrease)
   - 송신측은 패킷이 성공적으로 전달되면 윈도우 크기를 1씩 증가시키고, 실패하면 윈도우 크기를 절반으로 줄인다.
   - 공정한 방식이지만 초기 전송 속도가 낮고, 혼잡 발생 이후에만 반응하는 단점이 있다.
2. Slow Start
   - 처음에는 윈도우 크기를 1로 시작하여, ACK를 받을 때마다 윈도우 크기를 두 배로 증가시킨다.
   - 혼잡 발생 시 윈도우 크기를 1로 줄인다.
   - 혼잡이 발생한 시점의 절반까지는 지수적으로 증가하고, 이후에는 선형적으로 증가한다.
3. 혼잡 회피 (Congestion Avoidance)
   - 윈도우 크기가 임계값에 도달한 이후에는 전송 속도를 완만하게 증가시킨다.
   - ACK를 받으면 윈도우 크기를 1씩 증가시키고, ACK를 받지 못하면 타임아웃으로 판단하고 윈도우 크기를 1로 줄인다.
   - 임계값은 패킷 손실 시점의 윈도우 크기의 절반으로 설정된다.
4. Fast Retransmit
   - 수신측이 손실된 패킷의 ACK 대신 중복된 ACK를 보내게 되며, 송신측은 중복된 ACK를 3번 수신하면 해당 패킷을 재전송한다.
   - 혼잡을 빠르게 감지하고 재전송할 수 있다.
5. Fast Recovery
   - 혼잡 발생 시 윈도우 크기를 1로 줄이지 않고 절반으로 줄인 뒤, 선형적으로 증가시킨다.
   - 혼잡 발생 이후에는 AIMD 방식으로 윈도우 크기를 조절하게 된다.

---

## 3. 오류 제어 

### ARQ (Automatic Repeat reQuest)

- 정의: 신뢰성 있는 데이터 전달을 위해 재전송을 기반으로 한 에러 제어 방식.

### Stop and Wait ARQ

- 동작 방식: 송신측은 수신측에서 보내준 ACK를 받을 때까지 전송한 프레임의 복사본을 유지.
- 프레임 번호: 데이터 프레임과 ACK 프레임은 각각 0, 1 번호를 부여.
- NAK 처리: 수신측에서 데이터를 받지 못한 경우, NAK를 송신측에 보냄. 송신측은 NAK를 받은 후 데이터를 재전송.
- 타임아웃: 데이터나 ACK가 분실되었을 경우, 일정 간격의 시간을 두고 타임아웃이 되어 송신측이 데이터를 재전송.

### Go-Back-n ARQ (GBn ARQ)

- 정의: 전송된 프레임이 손상되거나 분실될 경우, 확인된 마지막 프레임 이후로 모든 프레임을 재전송하는 기법.
- 슬라이딩 윈도우: 연속적인 프레임 전송 기법으로, 전송된 모든 프레임의 복사본을 가지고 있어야 하며, ACK와 NAK를 구별해야 함.

#### NAK 수신 후 재전송

- NAK 수신: 수신측에서 데이터 프레임 2가 손상되었다고 판단하면, NAK 2를 송신측에 보냄.
- 재전송: 송신측은 NAK 2를 받은 후, 데이터 프레임 2 이후의 모든 데이터를 재전송.

#### 전송 데이터 프레임 분실

- 프레임 분실: 예를 들어, 데이터 1을 받았고, 다음에 데이터 3을 받았을 때, 수신측은 데이터 2를 받지 못했으므로 데이터 3을 폐기하고 NAK 2를 송신측에 보냄.
- 재전송: 송신측은 NAK 2를 받은 후, 데이터 2부터 재전송을 시작.

#### ACK 분실 (Lost ACK)
- 타이머 사용: 송신측은 ACK가 분실되면 타이머를 통해 ACK를 재전송.
- 재전송 시나리오: 타임아웃이 발생하면, 마지막 ACK된 데이터부터 재전송.

### Selective-Reject (SR) ARQ

- 정의: GBn ARQ의 단점을 개선한 방법으로, 손상되거나 분실된 프레임만 재전송.
- 장점: 불필요한 데이터 재전송을 줄여 효율적인 전송.
- 단점: 데이터 재정렬이 필요하며, 별도의 버퍼가 요구됨.

---

### 참고자료

[흐름제어와 혼잡제어](https://github.com/GimunLee/tech-refrigerator/blob/master/Network/%ED%9D%90%EB%A6%84%EC%A0%9C%EC%96%B4%20%26%20%ED%98%BC%EC%9E%A1%EC%A0%9C%EC%96%B4%20%26%20%EC%98%A4%EB%A5%98%EC%A0%9C%EC%96%B4.md)
