# CSRF(Cross-Site Request Forgery)

---

## 1. Cross-Site Request Forgery (CSRF)

- CSRF (사이트 간 요청 위조)란, 사용자가 의도하지 않은 요청을 공격자가 대신 특정 웹사이트에 보내게 만드는 공격이다. 
- 즉, 사용자는 모르는 사이에 서버를 공격하게 된다.

### 쿠키와 세션

- CSRF 공격을 이해하려면 쿠키와 세션의 동작을 알아야 한다. 
- 사용자가 서버에 로그인하면, 서버는 사용자 정보를 세션에 저장하고 세션 ID를 생성한다. 
- 서버는 이 세션 ID를 Set-Cookie 헤더로 클라이언트(브라우저)에 전달한다. 
- 브라우저는 이 세션 ID를 쿠키에 저장한다. 
- 이후 같은 도메인으로 요청할 때마다 브라우저는 자동으로 쿠키(세션 ID 포함)를 서버에 보낸다. 
- 서버는 쿠키에 담긴 세션 ID로 사용자가 인증되었는지 확인한다.

### CSRF 공격 조건과 과정

- CSRF 공격이 성공하기 위한 조건
  - 사용자가 이미 서버에 로그인(인증)되어 있어야 한다. 
  - 서버는 세션 정보를 쿠키 기반으로 관리해야 한다. 
  - 공격자는 서버의 요청 방식(Request Format)을 알고 있어야 한다.
- 공격 과정 
  - 사용자가 보안이 취약한 서버에 로그인한다. 
  - 서버는 사용자 정보를 세션에 저장하고, 브라우저는 세션 키를 쿠키에 저장한다. 
  - 공격자는 악성 스크립트를 포함한 페이지를 준비한다. 
  - 사용자가 이메일, 게시판 등을 통해 악성 페이지에 접속하도록 유도된다. 
  - 사용자가 악성 페이지에 접속하면, 스크립트가 서버로 요청을 보낸다. 
  - 이때 브라우저는 쿠키(세션 키)를 자동으로 요청에 포함한다. 
  - 서버는 요청에 포함된 쿠키를 보고 "인증된 사용자"의 요청으로 오인하여 악의적인 작업을 처리한다.
- 쿠키의 SameSite 정책에 따라 외부 사이트 요청 시 쿠키 전달이 제한될 수 있지만, 정책 설정에 따라 여전히 공격이 가능할 수 있다.

## 2. 공격방법과 대응방안

- [CSRF의 공격방법과 대응방안]() 에서 자세히 다룰 것이다.

---

### 참고자료

[CSRF(Cross-Site Request Forgery)](https://junhyunny.github.io/information/security/spring-boot/spring-security/cross-site-reqeust-forgery/)