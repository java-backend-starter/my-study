# 서브쿼리

---

## 1. 개요

- 서브쿼리는 한 쿼리 내에 포함된 또 다른 쿼리이다.
- 주로 SELECT, WHERE, FROM 등 다양한 절에서 사용된다. 
- 서브쿼리는 반드시 괄호 `()`로 감싸야 하며, 결과에 따라 다양한 용도로 활용할 수 있다.
- 서브쿼리는 여러 곳에서 활용할 수 있는 매우 유용한 도구이며, 조건에 맞는 데이터를 효율적으로 조회하고 필터링하는 데 도움을 준다.

---

## 2. 서브쿼리의 특징

- 사용 위치: 서브쿼리는 `GROUP BY` 절을 제외한 모든 절에서 사용 가능하다.
- 괄호: 서브쿼리는 반드시 괄호 `()` 안에 포함되어야 한다.

---

## 3. 서브쿼리의 종류와 사용법

### SELECT 절의 서브쿼리 (스칼라 서브쿼리)

```sql
SELECT [컬럼], (SELECT [컬럼] FROM [테이블] WHERE 조건)
FROM [테이블]
WHERE 조건;
```
- 특징: SELECT 절에서 서브쿼리는 반드시 하나의 값만 반환해야 합니다.
- 용도: SELECT 절에서 결과로 하나의 값을 도출하는 데 사용됩니다.

### FROM 절의 서브쿼리 (인라인 뷰 서브쿼리)

```sql
SELECT [컬럼]
FROM (SELECT [컬럼] FROM [테이블] WHERE [조건]) AS [별명]
WHERE 조건;
```
- 특징: FROM 절의 서브쿼리는 결과가 반드시 하나의 테이블이어야 하며, 이 테이블에 별명을 `alias`로 지정해야 합니다.
- 용도: 서브쿼리 결과를 임시 테이블처럼 사용하며, 복잡한 쿼리를 단순화하는 데 유용합니다.

### WHERE 절의 서브쿼리 (중첩 서브쿼리)

```sql
SELECT [컬럼]
FROM [테이블]
WHERE [컬럼][연산자](SELECT [컬럼] FROM [테이블] WHERE 조건);
```
- 특징: WHERE 절에서 서브쿼리는 하나의 컬럼을 반환해야 하며, 여러 값이 있을 수 있습니다. 단, `EXISTS` 연산자 사용 시 예외입니다.
- 용도: 주로 필터링 조건을 지정할 때 사용됩니다.

---

## 4. 주요 연산자와 사용법

### 비교 연산자 사용 시

- 서브쿼리에서 비교 연산자(`=`, `>`, `<`, `<=`, `>=`, `!=`)를 사용할 때, 서브쿼리의 결과는 반드시 하나의 값이어야 합니다.

| 연산자 | 활용                | 의미                                           |
|--------|---------------------|------------------------------------------------|
| =      | A = [서브 쿼리]     | A와 [서브 쿼리]의 결과값이 같다               |
| !=     | A != [서브 쿼리]    | A와 [서브 쿼리]의 결과값이 같지 않다          |
| >      | A > [서브 쿼리]     | A가 [서브 쿼리]의 결과값보다 크다             |
| >=     | A >= [서브 쿼리]    | A가 [서브 쿼리]의 결과값보다 크거나 같다      |
| <      | A < [서브 쿼리]     | A가 [서브 쿼리]의 결과값보다 작다             |
| <=     | A <= [서브 쿼리]    | A가 [서브 쿼리]의 결과값보다 작거나 같다      |


### 주요 연산자

- `EXISTS`
  - 서브쿼리 결과가 존재하면 `TRUE`, 없으면 `FALSE`를 반환한다. 
  - 여러 컬럼을 반환해도 괜찮다.
- `ALL`
  - 서브쿼리를 통해 도출된 컬럼 값 중에서 가장 작은 값과 비교하려면 `>`(크다)와 함께 사용하고, 가장 큰 값과 비교하려면 `<`(작다)와 함께 사용한다.
- `ANY`
  - 서브쿼리를 통해 도출된 컬럼 값 중에서 가장 큰 값과 비교하려면 `<`(작다)와 사용하고, 가장 작은 값과 비교하려면 `>`(크다)와 사용한다.

| 연산자   | 활용                                | 의미                                               |
|----------|-------------------------------------|----------------------------------------------------|
| IN       | A IN ([서브 쿼리])                  | A가 [서브 쿼리]의 결과값 내에 있다.               |
| ALL      | A < ALL ([서브 쿼리])               | A가 모든 [서브 쿼리]의 결과값보다 작다.           |
|          | A > ALL ([서브 쿼리])               | A가 모든 [서브 쿼리]의 결과값보다 크다.           |
| ANY      | A < ANY ([서브 쿼리])               | A가 [서브 쿼리]의 결과값보다 하나라도 작다.       |
|          | A > ANY ([서브 쿼리])               | A가 [서브 쿼리]의 결과값보다 하나라도 크다.       |
| EXISTS   | EXISTS ([서브 쿼리])                | [서브 쿼리]의 결과값이 존재한다.                  |
|          | NOT EXISTS ([서브 쿼리])            | [서브 쿼리]의 결과값이 존재하지 않는다.           |

---

## 5. EXISTS 연산자

- 특징: 서브쿼리가 결과를 반환하면 `TRUE`를, 그렇지 않으면 `FALSE`를 반환합니다.
- 예시
```sql
SELECT [컬럼]
FROM [테이블]
WHERE EXISTS (SELECT 1 FROM [다른 테이블] WHERE [조건]);
```

---

### 참고자료

[서브쿼리](https://yeong-jin-data-blog.tistory.com/entry/%EC%84%9C%EB%B8%8C%EC%BF%BC%EB%A6%AC-%EA%B8%B0%EB%B3%B8-%EA%B0%9C%EB%85%90)