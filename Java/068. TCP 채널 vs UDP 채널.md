# TCP채널 vs UDP 채널

---

## 1. 비교

| 항목 | TCP (SocketChannel) | UDP (DatagramChannel) |
|:---|:---|:---|
| 연결 | 연결형(Connection-oriented) | 비연결형(Connectionless) |
| 데이터 송수신 | 스트림 기반, `read()` / `write()` 사용 | 메시지 단위, `send()` / `receive()` 사용 |
| 신뢰성 | 신뢰성 보장, 순서 보장 | 신뢰성 미보장, 순서 미보장 |
| 블로킹/넌블로킹 | 지원 | 지원 |
| 사용 목적 | 안정적인 데이터 전송 필요 시 | 빠른 데이터 전송, 순서/신뢰성 필요 없는 경우 |
| 특징 | 연결 수립 후 통신 | 연결 없이 메시지 단위 통신 |

---

## 2. 사용법 예시

### TCP (SocketChannel)

```java
// 읽기
ByteBuffer buffer = ByteBuffer.allocate(1024);
int bytesRead = socketChannel.read(buffer);
// buffer: 데이터를 저장할 ByteBuffer
// 반환값: 읽은 바이트 수, 상대방이 종료하면 -1 반환

// 쓰기
buffer.flip();
int bytesWritten = socketChannel.write(buffer);
// buffer: 전송할 ByteBuffer
// 반환값: 실제로 전송한 바이트 수
```

### UDP (DatagramChannel)

```java
// 전송
ByteBuffer buffer = ByteBuffer.wrap("Hello UDP".getBytes());
SocketAddress target = new InetSocketAddress("localhost", 5001);
int bytesSent = datagramChannel.send(buffer, target);
// buffer: 전송할 데이터 버퍼
// target: 수신측 주소 (IP + 포트)
// 반환값: 실제 전송한 바이트 수

// 수신
ByteBuffer buffer = ByteBuffer.allocate(1024);
SocketAddress sender = datagramChannel.receive(buffer);
// buffer: 수신 데이터를 저장할 버퍼
// 반환값: 데이터를 보낸 상대방 주소, 데이터 없으면 null
buffer.flip();
String message = new String(buffer.array(), 0, buffer.limit());
```

---

## 3. 참고 사항

- UDP는 메시지 단위로 데이터를 송수신하므로 TCP의 스트림 방식과 다르게, 한 번에 전송되는 데이터 단위가 중요하다.
- 버퍼 크기를 초과하면 데이터가 잘릴 수 있으므로 주의.
- 블로킹/논블로킹 모드 설정은 TCP와 동일하게 `configureBlocking(true/false)`로 가능.

### 추가 참고 사항

1. UDP 메시지 크기 주의
    - `DatagramChannel`은 메시지 단위 전송이므로, 한 번에 전송되는 데이터 크기가 중요하다.
    - 일반적으로 UDP 패킷의 최대 크기는 약 65,507 바이트(IPv4 기준)이며, 이를 초과하면 데이터가 잘리거나 손실될 수 있다.
    - 따라서 버퍼 크기를 적절히 설정하고, 데이터 분할 전송이 필요할 수 있다.

2. TCP read() 종료 신호
    - `SocketChannel.read()` 호출 시 반환값이 `-1`이면, 상대방이 정상적으로 `close()`를 호출하여 연결을 종료했음을 의미한다.
    - 이는 예외가 아니라 정상적인 종료 신호이므로, read 루프에서 이를 처리하여 채널을 닫아야 한다.

---

### 참고 자료

[이것이 자바다](https://search.shopping.naver.com/book/catalog/32473359191?query=%EC%9D%B4%EA%B2%83%EC%9D%B4%20%EC%9E%90%EB%B0%94%EB%8B%A4)

[Java Docs - DatagramChannel](https://docs.oracle.com/javase/8/docs/api/java/nio/channels/DatagramChannel.html)

[Java Docs - SocketChannel](https://docs.oracle.com/javase/8/docs/api/java/nio/channels/SocketChannel.html)
