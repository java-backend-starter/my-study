# JUnit

---

## 1. Unit Test란?

- 단위 테스트(Unit Test)는 소프트웨어 개발에서 개별적인 코드 단위를 테스트하는 것을 의미한다.
- 클래스, 메서드, 함수 등 작은 단위를 격리하여 독립적으로 테스트한다.
- 자동화 및 반복 실행이 가능하며, 버그를 빠르게 발견하고 코드 변경 시 기존 기능에 미치는 영향을 검증하는 데 유용하다.

---

## 2. JUnit 5란?

- Java 언어에서 단위 테스트를 지원하는 프레임워크
- Java 8 이상부터 지원
- 다음 세 모듈의 결합 구조
  - JUnit Platform
  - JUnit Jupiter
  - JUnit Vintage

---

## 3. JUnit 5 구성 요소

### JUnit Platform

- JUnit 테스트를 실행하는데 사용되는 실행환경
    - 다양한 TestEngine 구현체를 실행하고 테스트 결과를 보고하는 역할
    - 테스트의 발견, 실행, 결과 보고 과정을 관리
    - TestEngine Interface를 통해 Jupiter, Vintage 등과 상호작용
    - JUnit 3·4·5 테스트를 모두 지원

#### Test Framework와 TestEngine 차이

- Test Framework는 테스트 작성 규칙과 구조 제공
- TestEngine은 테스트를 실제로 실행하고 결과를 반환

### TestEngine Interface

- JUnit Platform에서 테스트 엔진을 정의하는 인터페이스
- 각각의 TestEngine은 특정한 테스트 프레임워크 또는 런처와 통합되어 동작하며, 테스트 수명주기 관리, 테스트 실행, 결과 보고 등의 기능을 제공
- 사용자 정의 TestEngine 구현 가능

#### 주요 메서드

메서드 | 설명
---|---
discover() | 테스트 발견 및 ID 부여
execute() | 테스트 실행
getId() | 엔진 고유 ID 반환
getGroupId() | 그룹 ID 반환
getVersion() | 엔진 버전 반환

### TestEngine

- TestEngine Interface의 구현체로 JUnit Platform에서 테스트를 실행하는 데 사용되는 구현체
- 각각의 TestEngine은 특정한 테스트 프레임워크 또는 런처와 통합되어 동작
- 테스트 수명주기 관리, 실행, 결과 보고 담당

### JUnit Jupiter

- JUnit 5의 핵심 테스트 프레임워크
- 테스트 작성과 실행을 위한 새로운 기능과 어노테이션을 제공
    - JUnit 4보다 더 유연하고 강력한 테스트 작성 가능

#### 주요 어노테이션 (일부)

어노테이션 | 설명
---|---
@Test | 테스트 메서드 정의
@ParameterizedTest | 매개변수화 테스트
@BeforeEach | 각 테스트 전 실행
@AfterEach | 각 테스트 후 실행

### JUnit Vintage

- JUnit 3·4 테스트를 JUnit 5 Platform에서 실행 가능
- 기존 테스트 유지와 JUnit 5 환경 활용 가능

---

## 4. 구성 요소 전반적 흐름

1. IDE에서 테스트 실행
2. JUnit Platform에서 테스트 관리
3. TestEngine Interface를 통해 테스트 호출
4. 실제 실행은 Jupiter, Vintage, Custom Engine이 담당

---

## 5. JUnit 5 주요 어노테이션

어노테이션 | 설명
---|---
@Test	| 테스트 메소드임을 나타내는 어노테이션
@ParameterizedTest |	매개변수화된 테스트를 위한 어노테이션
@RepeatedTest |	반복적으로 실행되는 테스트를 위한 어노테이션
@TestFactory |	동적으로 테스트를 생성하는 팩토리 메소드를 정의하는 어노테이션
@TestTemplate |	테스트 템플릿을 정의하는 어노테이션
@TestClassOrder	| 테스트 클래스의 실행 순서를 지정하는 어노테이션
@TestMethodOrder |	테스트 메소드의 실행 순서를 지정하는 어노테이션
@TestInstance |	테스트 인스턴스의 생명주기를 지정하는 어노테이션
@DisplayName |	테스트의 표시 이름을 설정하는 어노테이션
@DisplayNameGeneration |	테스트의 표시 이름을 동적으로 생성하는 어노테이션
@BeforeEach |	각 테스트 메소드 실행 전에 실행되는 메소드를 정의하는 어노테이션
@AfterEach	| 각 테스트 메소드 실행 후에 실행되는 메소드를 정의하는 어노테이션
@BeforeAll | 모든 테스트 메소드 실행 전에 실행되는 메소드를 정의하는 어노테이션
@AfterAll	| 모든 테스트 메소드 실행 후에 실행되는 메소드를 정의하는 어노테이션
@Nested	| 중첩된 테스트 클래스를 정의하는 어노테이션
@Tag	| 테스트를 그룹화하기 위한 태그를 지정하는 어노테이션
@Disabled	| 비활성화된 테스트를 나타내는 어노테이션
@Timeout	| 테스트의 제한 시간을 설정하는 어노테이션
@ExtendWith	| 커스텀 확장을 적용하는 어노테이션
@RegisterExtension	| 커스텀 확장을 등록하는 어노테이션
@TempDir |	테스트용 임시 디렉터리를 생성하는 어노테이션

---

## 6. JUnit 5 Assertions

- 테스트 결과를 검증하기 위한 메서드
- org.junit.jupiter.api.Assertions 패키지 사용

### 주요 Assertion 메서드

메서드 | 구분 |  설명
---|---|---
`assertEquals(expected, actual)` |	JUnit 4~ |	예상값과 실제값이 동일한지 확인합니다.
`assertArrayEquals(expected, actual)` |	JUnit 4~	| 예상 배열과 실제 배열이 동일한지 확인합니다.
`assertNull(object)`	| JUnit 4~	| 객체가 null인지 확인합니다.
`assertNotNull(object)`	| JUnit 4~	| 객체가 null이 아닌지 확인합니다.
`assertSame(expected, actual)`	| JUnit 4~	| 예상값과 실제값이 같은 객체인지 확인합니다.
`assertNotSame(expected, actual)`	| JUnit 4~	| 예상값과 실제값이 다른 객체인지 확인합니다.
`assertTrue(condition)`	| JUnit 4~	| 조건이 참인지 확인합니다.
`assertFalse(condition)`	| JUnit 4~	| 조건이 거짓인지 확인합니다.
`assertAll(Executable... executables)`	| JUnit 5	| 모든 단언문(assertion)이 성공하는지 확인합니다.
`assertIterableEquals(Iterable<?> expected, Iterable<?> actual)` |	JUnit 5	| 예상 가능한 순서로 반복 가능한 항목이 동일한지 확인합니다.
`assertLinesMatch(List<String> expectedLines, List<String> actualLines)`	| JUnit 5	| 두 문자열 목록이 일치하는지 확인합니다.
`assertNotEquals(Object unexpected, Object actual)`	| JUnit 5 | 	예상값과 실제값이 동일하지 않은지 확인합니다.
`assertThrows(Class<T> expectedType, Executable executable)`	JUnit 5	|지정된 예외가 발생하는지 확인합니다.
`assertTimeout(Duration timeout, Executable executable)` |	JUnit 5	| 주어진 시간 내에 작업이 완료되는지 확인합니다.
`assertTimeoutPreemptively(Duration timeout, Executable executable)`	| JUnit 5	| 주어진 시간 내에 작업이 완료되는지 확인하며, 작업이 중단될 수 있습니다.

---

## 7. JUnit 라이프사이클

### 라이프사이클

단계  |	설명
---|---
Setup |	각 테스트 메서드가 실행되기 전에 필요한 설정 작업을 수행
Test |	실제 테스트가 진행되는 주요 단계입니다. 각 테스트 메서드는 개별적으로 실행되며, 코드의 예상 동작을 확인하기 위해 어설션(assertion) 또는 검증(verification)이 수행
Cleanup	| 각 테스트 메서드가 실행된 후 필요한 정리 작업을 수행합
Suite-level setup and cleanup | 테스트 스위트의 모든 테스트 메서드 실행 전후에 한 번씩 발생. 테스트 스위트 전체에 적용되어야 하는 설정 또는 정리 작업을 수행하는 데 사용

### 실행 순서

1. @BeforeAll : JUnit 클래스가 수행되면 최초 한번 @BeforeAll 어노테이션을 선언한 메서드가 실행
2. @BeforeEach : @Test을 찾았다면 테스트 실행 전 @BeforeEach을 선언한 메서드가 실행
3. @Test : @Test를 선언한 메서드가 실행
4. @AfterEach : @Test 실행을 마치면 @AfterEach를 선언한 메서드가 실행
5. @Test를 선언한 메서드가 있는지 찾으며 존재하면 (2. 과정)을 반복수행하며, 존재하지 않는 경우 (6. 과정)을 수행
6. @AfterAll : 실행할 @Test가 존재하지 않는다면 @AfterAll을 선언한 메서드를 수행
7. 테스트 종료 

---

## 8. 테스트 코드 구조화 패턴

### AAA 패턴

#### 특징

- Arrange(준비), Act(실행), Assert(검증)의 약자로, 테스트 코드를 구조화하는 데 유용한 패턴

#### 구조

- Arrange
    - 테스트 준비
    - 테스트에 필요한 객체나 데이터를 설정하는 단계로 테스트하려는 객체를 생성하고 모든 의존성을 준비
- Act
    - 테스트 실행
    - 준비된 객체나 데이터를 사용하여 실제로 테스트하려는 동작을 실행하는 단계
- Assert
    - 결과 검증
    - 실행 결과가 예상한 대로인지 확인하는 단계. JUnit의 assert 메서드를 사용하여 결과를 검증

#### 예시

```java
@SpringBootTest
class MyServiceTest {

    @Autowired
    private MyService myService;

    @Test
    void testCalculate() {
        // Arrange
        int input = 5;

        // Act
        int result = myService.calculate(input);

        // Assert
        assertEquals(10, result);
    }
}
```

### Given-When-Then 패턴

#### 특징

- 테스트 케이스를 더 가독성 있고 유지보수하기 쉽게 구조화하는 방법
- 이 패턴을 따르면 테스트 케이스가 더 구체적이고 이해하기 쉬워지며 각각의 단계를 분리하여 각 테스트 부분이 어떤 역할을 담당하는지 명확해진다.

#### 구조

- Given
    - 사전 조건
    - 테스트의 초기 상태 또는 사전 조건을 설정합니다. 입력 데이터나 테스트가 실행될 문맥을 지정
- When
    - 실행 동작
    - 테스트되는 동작 또는 이벤트를 설명
    - 테스트되는 특정 메서드나 동작을 나타낸다.
- Then
    - 기대 결과
    - "When" 섹션에서 설명한 동작으로 인해 기대되는 결과 또는 동작을 정의

#### 예시

```java
import org.junit.jupiter.api.Test;
import java.util.ArrayList;
import static org.junit.jupiter.api.Assertions.*;

class MyTest {

    @Test
    void testListSize() {
        // Given
        ArrayList<String> list = new ArrayList<>();

        // When
        list.add("Apple");
        list.add("Banana");
        list.add("Orange");

        // Then
        assertEquals(3, list.size());
        assertTrue(list.contains("Apple"));
        assertFalse(list.isEmpty());
    }
}
```

---

## 9. JUnit 테스트 명명 규칙

### 대표적인 전략

1. MethodName_State_Expected
2. MethodName_Expected_State
3. testFeature
4. 기능 중심 이름
5. Should_Expected_When_State
6. When_State_Expect_Expected
7. Given_When_Then

- 테스트의 의도와 행위가 드러나도록 명확하게 작성하는 것이 핵심

---

### 출처

[JUnit](https://adjh54.tistory.com/341)