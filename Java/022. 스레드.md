# 스레드

---

## 1. 멀티 스레드

### 프로세스와 스레드

- 프로세스(Process): 실행 중인 하나의 애플리케이션을 의미하며, 운영체제로부터 메모리를 할당받아 코드가 실행된다.
    - 예: Chrome 브라우저를 두 개 실행하면 두 개의 Chrome 프로세스가 생성됨.
- 멀티 태스킹(Multi Tasking): 두 가지 이상의 작업을 동시에 처리하는 것.
    - 운영체제는 CPU와 메모리 자원을 여러 프로세스에 적절히 분배하여 병렬로 실행함.
    - 예: 워드로 문서 작업하면서 음악 재생.
- 멀티 프로세스 vs 멀티 스레드
    - 멀티 프로세스: 각 프로세스는 독립적인 메모리 공간을 가짐. 한 프로세스의 오류가 다른 프로세스에 영향을 주지 않음.
    - 멀티 스레드: 하나의 프로세스 내에서 여러 작업을 병렬 처리. 스레드는 메모리를 공유하기 때문에 하나의 스레드에서 예외 발생 시 전체 프로세스에 영향 가능.

### 예시 애플리케이션
 
- 미디어 플레이어: 영상 재생 + 음악 재생
- 메신저: 채팅 + 파일 전송

### 스레드(Thread)
 
- 코드의 실행 흐름을 담당하는 한 가닥의 실과 같음.
- 하나의 프로세스에 스레드가 두 개 존재하면 두 개의 실행 흐름이 생김 → 동시에 여러 작업 수행 가능.
- 멀티 프로세스는 애플리케이션 단위의 멀티 태스킹,  
  멀티 스레드는 애플리케이션 내부의 멀티 태스킹.

### 주의점
 
- 멀티 스레드에서는 예외 처리에 주의해야 함.
    - 예: 메신저에서 파일 전송 중 예외 발생 시, 전체 메신저 종료 → 채팅도 중단됨.

### 멀티 스레드 사용 예시
 
- 대용량 데이터 병렬 처리
- UI 애플리케이션에서 네트워크 통신
- 서버의 다수 클라이언트 요청 처리

---

## 2. 메인 스레드

- 모든 자바 애플리케이션은 main() 메서드를 실행하는 메인 스레드로 시작함.
    - main()의 첫 코드부터 마지막까지 순차적으로 실행.
    - main()이 종료되면 메인 스레드도 종료.

### 병렬 처리

- 메인 스레드는 필요 시 작업 스레드를 생성하여 병렬 실행 가능.
    - 예: 메인 스레드 → 작업 스레드1 실행 → 작업 스레드2 실행

### 프로세스 종료 조건

- 싱글 스레드 애플리케이션: 메인 스레드가 종료되면 프로세스 종료.
- 멀티 스레드 애플리케이션: 작업 스레드가 살아 있으면 메인 스레드 종료 후에도 프로세스는 종료되지 않음.

---

## 3. 요약

1. 멀티 프로세스 vs 멀티 스레드
    - 프로세스는 독립적 / 스레드는 메모리 공유.
2. 메인 스레드와 작업 스레드의 실행 흐름
    - 메인 스레드가 다른 스레드를 생성하고 병렬 실행하는 모습.

---

## 4. 스래드의 생성과 실행

### 스레드 생성 방식 두 가지

#### Runnable 인터페이스 구현 

- Runnable 구현 클래스 또는 익명 객체로 작업 정의 
- Thread 생성자에 전달 후 start() 호출
- 예시
```java
Thread thread = new Thread(new Runnable() {
    public void run() {
        // 작업 내용
    }
});
thread.start();
```
- 람다식 사용 가능 (Java 8 이상):
```java
Thread thread = new Thread(() -> {
    // 작업 내용
});
```

#### Thread 클래스를 상속

- Thread의 하위 클래스에서 run()을 오버라이딩 
- 객체 생성 후 start() 호출 
- 예시
```java
class MyThread extends Thread {
    public void run() {
        // 작업 내용
    }
}

Thread thread = new MyThread();
thread.start();
```

### 스레드 이름 설정 및 조회

- 기본 이름: "main" (메인 스레드), "Thread-n" (사용자 생성)
- 설정: thread.setName("이름"); 
- 조회: thread.getName(); 
- 현재 실행 중인 스레드 객체 참조:
```java
Thread current = Thread.currentThread();
```

---

## 5. 데몬 스레드란?

- 주 스레드(main thread)를 보조하는 역할을 수행하는 백그라운드 스레드 
- 주 스레드가 종료되면 자동으로 같이 종료됨 
- 일반 스레드와 동작 방식은 거의 같으나, 종료 방식에서 차이

### 특징

| 항목       | 내용                                                  |
|------------|-------------------------------------------------------|
| 용도       | 보조 작업 (자동 저장, 음악/영상 재생, 가비지 컬렉션 등) |
| 종료 시점  | 주 스레드가 종료되면 자동으로 종료                     |
| 설정 방법  | `setDaemon(true)` 호출 (반드시 `start()` 호출 전)      |
| 확인 방법  | `isDaemon()` → 데몬 스레드면 `true` 반환               |


### 사용 방법 예시

```java
AutoSaveThread thread = new AutoSaveThread();
thread.setDaemon(true);  // 데몬 스레드로 설정
thread.start();          // 반드시 setDaemon() 이후 호출
```
- start() 호출 후에 setDaemon(true) 호출하면 IllegalThreadStateException 예외 발생

---

## 6. 일반 스레드 vs 데몬 스테드

| 구분           | 일반 스레드                              | 데몬 스레드                                  |
|----------------|-------------------------------------------|-----------------------------------------------|
| 목적           | 메인 작업 수행                            | 보조 작업 수행 (자동 저장, GC 등)             |
| 종료 조건      | 작업이 끝날 때까지 계속 실행               | 모든 일반 스레드가 종료되면 자동 종료         |
| 설정 방법      | 기본적으로 일반 스레드                    | `setDaemon(true)` 호출로 설정                  |
| 우선 순위      | 데몬 스레드보다 높을 수 있음               | 일반 스레드보다 낮은 경우가 많음              |
| 자원 정리 여부 | 명시적으로 자원 정리 필요                  | 보통 강제 종료되므로 자원 정리 보장되지 않음  |
| 예시           | 사용자 입력 처리, 파일 저장 등             | 자동 저장, 음악 재생, 가비지 컬렉션 등         |

---

### 참고자료

[이것이 자바다](https://search.shopping.naver.com/book/catalog/32473359191?query=%EC%9D%B4%EA%B2%83%EC%9D%B4%20%EC%9E%90%EB%B0%94%EB%8B%A4&NaPm=ct%3Dm7ne3c9k%7Cci%3D6356ea398110d474e244102192a893d910277fb2%7Ctr%3Dboksl%7Csn%3D95694%7Chk%3Da51fed5127109d9f5a3bd6af6be4725cd7500518)