# 동기화 문제 해결 방법

---

## 1. 동기화에서 발생하는 문제

### Deadlock (교착상태)

- 정의: 두 개 이상의 프로세스가 서로를 기다리며, 무한히 대기 상태에 빠지는 상황입니다. 
- 원인: 두 프로세스가 서로 다른 자원을 점유하며, 다른 자원에 대해 대기하는 경우 발생합니다. 
- 예시
  - 프로세스 P1은 자원 S를 잠그고 Q를 기다립니다. 
  - 프로세스 P2는 자원 Q를 잠그고 S를 기다립니다. 
  - 이 경우, P1과 P2는 서로의 자원을 기다리며, 영원히 대기 상태에 빠집니다.

### Starvation (기아) - Infinite Blocking (무한 대기)

- 정의: 한 프로세스가 자원을 영원히 얻지 못하고 무한히 대기하는 상태입니다. 
- 원인: 주로 우선순위가 낮은 프로세스가 항상 다른 프로세스에 의해 차단되어 자원을 얻지 못하는 경우 발생합니다. 
- 예시: 세마포어 큐에서 낮은 우선순위의 프로세스가 계속해서 다른 프로세스에 의해 차단될 수 있습니다.

### Priority Inversion (우선순위 역전)

- 정의: 낮은 우선순위의 프로세스가 자원에 대한 접근을 기다리는 동안, 우선순위가 높은 프로세스가 차단되는 상황입니다. 
- 원인: 낮은 우선순위의 프로세스가 자원을 점유한 상태에서, 높은 우선순위 프로세스가 그 자원을 기다리게 되면 발생합니다. 
- 예시
  - 프로세스 P1은 세마포어 S를 잠그고 있습니다. 
  - 프로세스 P2 (우선순위 높은 프로세스)는 S를 기다립니다. 
  - 프로세스 P3 (우선순위 낮은 프로세스)는 세마포어 S를 기다리지 않고 실행됩니다. 
  - P2는 P1이 자원 S를 풀 때까지 대기해야 하며, P3가 실행됨에 따라 P2의 대기 시간이 길어지고 우선순위가 뒤바뀐 것처럼 보이게 됩니다.
- 해결 방법 : 우선순위 상속 프로토콜 (Priority Inheritance Protocol)
  - 상위 우선순위 프로세스를 막고 있는 동안 우선순위를 상속한다.

---

## 2. 해결방법

### 임계 구역(Critical Section)

- 여러 스레드가 공유 자원에 동시에 접근할 때 발생할 수 있는 문제를 방지하기 위해, 특정 코드 영역에 대한 접근을 제한하는 기법입니다.
- 해결 조건
  - 상호 배제(Mutual Exclusion): 한 번에 하나의 스레드만 임계 구역에 접근해야 합니다. 
  - 유한 대기(Bounded Waiting): 무한정 대기하지 않도록 보장해야 합니다. 
  - 진행의 융퉁성(Progress): 임계 구역이 비어 있다면 언제든지 접근할 수 있어야 합니다.

### 동기화 도구들

#### Interrupt Masking
   
- 인터럽트를 비활성화하여 다른 스레드의 개입을 방지합니다. 
- 싱글 프로세서 환경에서만 사용 가능하며, 멀티 프로세서 환경에서는 효과적이지 않습니다.

#### Mutex Locks

- 상호 배제 문제를 해결하는 가장 기본적인 도구입니다. 
- lock()과 unlock()을 통해 임계 구역에 대한 접근을 제어합니다. 
- 단점으로는 "busy waiting" 문제가 발생할 수 있습니다.

#### Semaphore

- 상호 배제 문제를 해결하는 데 사용되며, wait()와 signal() 연산을 통해 동기화를 수행합니다. 
- Binary Semaphore는 Mutex와 유사하며, Counting Semaphore는 여러 개의 자원에 대한 동기화를 제공합니다. 
- wait() 연산을 통해 대기열에 들어가게 하여 busy waiting 문제를 완화합니다.

#### Monitor

- Mutex와 Semaphore의 단점을 보완한 고급 동기화 도구입니다. 
- 공유 자원에 대한 접근을 내부적으로 숨기고, wait()와 notify() 메서드를 통해 동기화를 처리합니다. 
- Java에서는 synchronized 키워드를 사용하여 모니터를 구현할 수 있습니다.

---

### 참고자료

[동기화로 인한 문제](https://velog.io/@guswns3371/%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C-%EB%8F%99%EA%B8%B0%ED%99%94-%EB%AC%B8%EC%A0%9C%EC%9D%98-%ED%95%B4%EA%B2%B0%EC%B1%85#%EB%8F%99%EA%B8%B0%ED%99%94%EB%A1%9C-%EC%9D%B8%ED%95%B4-%EB%B0%9C%EC%83%9D%ED%95%98%EB%8A%94-%EB%AC%B8%EC%A0%9C)

[동기화로 인한 문제 해결방법](https://mysterlee.tistory.com/58)