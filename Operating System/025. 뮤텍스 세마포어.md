# 뮤텍스와 세마포어

---

## 1. 뮤텍스 (Mutex)

### 정의  

- 공유 자원에 하나의 스레드만 접근 가능하도록 보장하는 상호배제(Mutual Exclusion) 기법.
- Mutual Exclusion의 줄임말로, 락(Lock)이라고도 한다.

### 특징

- 임계 구역(Critical Section)에 한 번에 하나의 스레드만 접근 가능
- 동기화를 위해 락(Lock)을 사용하며, 락이 걸린 자원은 다른 스레드나 프로세스가 접근 불가
- 락을 소유한 스레드만 락을 해제(unlock) 가능 → 소유권 존재
- 락이 걸려 있으면 Entry Queue에서 대기하며, 락이 풀릴 때까지 대기
- 프로세스 종료 시 자동으로 정리됨

### 고급 사용: ReentrantLock

- `synchronized`보다 더 유연하게 락을 조작할 수 있음
- 수동으로 락 획득/해제
- 복잡한 코드 흐름에서도 사용 가능
- 타임아웃 설정 가능
- Condition 객체로 특정 조건의 스레드만 깨어나게 제어 가능
- `lockInterruptibly()`를 통해 인터럽트 가능한 대기 구현 가능

---

## 2. 세마포어 (Semaphore)

### 정의

- 공유 자원 접근을 여러 스레드/프로세스 간 제한하기 위한 카운터 기반 동기화 기법

### 특징

- 자원을 사용하는 프로세스 수를 관리하는 정수 값
- 지정된 최대 수만큼 동시 접근 가능
- 운영체제 또는 커널 수준에서 관리
- 자원이 사용 중이면 대기 후 재시도 필요
- 소유 개념 없이 누구나 값을 변경 가능
- 파일 시스템 상에 존재하며 시스템 전체에 영향 가능
- Binary 또는 Counting 세마포어로 구성 가능

### 종류
- Binary Semaphore (이진 세마포어)
    - 값이 0 또는 1만 가질 수 있음
    - 1: 자원 접근 가능 (unlock) / 0: 접근 불가 (lock)
    - 뮤텍스처럼 동작하며 상호 배제를 구현

- Counting Semaphore (계수형 세마포어)
    - 0 이상의 값을 가지며 여러 개의 프로세스가 동시에 접근 가능
    - 자원의 개수만큼 동시 접근을 허용

### 주요 연산
- P() / wait() / acquire()
    - 세마포어 값을 1 감소
    - 값이 0이면 대기 큐에 들어가며, 자원이 생길 때까지 대기

- V() / signal() / release()
    - 세마포어 값을 1 증가
    - 대기 중인 프로세스(또는 스레드)를 깨워 자원 접근을 허용

---

## 3. 뮤텍스 vs 세마포어

| 항목               | 뮤텍스 (Mutex)                                      | 세마포어 (Semaphore)                                     |
|--------------------|------------------------------------------------------|-----------------------------------------------------------|
| 동작 방식          | 잠금(Locking) 메커니즘 기반                         | 신호(Signaling) 메커니즘 기반                            |
| 자원 접근 수       | 1개                                                  | 1개 이상                                                  |
| 동기화 대상        | 하나의 공유 자원                                     | 하나 이상의 공유 자원                                    |
| 소유권             | 있음 (락을 획득한 스레드가 소유)                    | 없음 (누구나 접근 가능)                                   |
| 해제 권한          | 락을 소유한 스레드만 해제 가능                      | 어떤 스레드든 해제 가능                                   |
| 스레드 간 제어     | 다른 스레드를 직접 깨울 수 없음                      | 다른 스레드를 깨어나게 할 수 있음                         |
| 우선순위 처리      | Priority Inheritance 지원 (우선순위 역전 방지)       | 우선순위 역전 발생 가능 (별도 기법 필요)                  |
| 기본 상태          | Binary (0 또는 1)                                    | Binary 또는 Counting (0 이상 정수)                        |
| 정리 방식          | 프로세스 종료 시 자동 정리                          | 파일 시스템 등에 존재하며 수동으로 정리 필요              |
| 사용 범위          | 주로 프로세스 내부에서 사용                         | 시스템 전체에서 사용 가능                                 |
| 뮤텍스/세마포어 전환 | 세마포어는 뮤텍스로 사용 가능                        | 뮤텍스는 세마포어로 사용 불가                             |

---

### 참고자료

[뮤텍스와 세마포어 1](https://velog.io/@heetaeheo/%EB%AE%A4%ED%85%8D%EC%8A%A4Mutex%EC%99%80-%EC%84%B8%EB%A7%88%ED%8F%AC%EC%96%B4Semaphore%EC%9D%98-%EC%B0%A8%EC%9D%B4)

[뮤텍스와 세마포어 2](https://jbground.tistory.com/73)