# 컨텍스트 스위칭

---

## 1. 컨텍스트 스위칭

- 컨텍스트 스위칭은 CPU(또는 코어)에서 실행 중인 프로세스나 스레드가 다른 프로세스나 스레드로 교체되는 것 
- 여기서 '컨텍스트(Context)'란 해당 작업의 상태 정보를 의미(CPU 레지스터, 프로그램 카운터, 메모리 상태 등을 포함)

### 필요한 이유

- 여러 프로세스와 스레드를 동시에 실행하는 것처럼 보이게 하기 위해
- CPU 시간을 공정하게 분배하기 위해
- 우선순위가 높은 작업을 빠르게 처리할 수 있도록 하기 위해

### 발생 시점

- Time Slice(Time Quantum)를 다 사용한 경우
- I/O 작업을 수행해야 할 경우
- 다른 리소스를 기다려야 할 경우
- 인터럽트(Interrupt)가 발생한 경우
- 이 외에도 트리거 등 다양한 시스템 이벤트에 의해 발생할 수 있음

### 컨텍스트 스위칭은 누가 실행하는가

- 컨텍스트 스위칭은 운영체제의 커널(Kernel)에 의해 수행
- 커널은 운영체제의 핵심 요소로, CPU, 메모리, I/O 등 시스템 리소스를 관리하고 감독하는 역할

---

## 2. 컨텍스트 스위칭의 과정

### 공통점 (프로세스와 스레드 간 스위칭)

1. 커널 모드에서 실행된다  
   일반적인 사용자 프로그램은 하드웨어 자원에 직접 접근하지 못하므로  
   시스템 호출 등을 통해 커널 모드로 전환되고, 커널이 작업을 대신 수행한다.
2. CPU 레지스터 상태를 저장하고 복원한다  
   레지스터는 CPU 연산을 위한 임시 저장소이며, 대표적으로 프로그램 카운터(PC), 스택 포인터(SP) 등이 있다.  
   현재 실행 중인 작업의 레지스터 값을 저장하고, 다음 작업의 값을 불러와 이어서 실행할 수 있도록 한다.

### 차이점: 프로세스 vs 스레드 간 스위칭

### 프로세스 컨텍스트 스위칭

- 서로 다른 프로세스 간의 전환으로, 가상 메모리 주소 체계가 다름
- 이로 인해 다음과 같은 추가 처리가 필요하다:
    - MMU (Memory Management Unit): 가상 주소를 물리 주소로 변환한다. 각 프로세스는 독립된 주소 공간을 가짐
    - TLB (Translation Lookaside Buffer): 주소 변환 결과를 캐싱하여 성능을 높인다. 프로세스가 바뀌면 초기화가 필요

### 스레드 컨텍스트 스위칭

- 같은 프로세스에 속한 스레드들 간의 전환으로, 메모리 공간(코드, 데이터, 힙)을 공유
- 메모리 주소 전환이 필요하지 않기 때문에, 상태 저장과 로딩만으로 전환이 가능

---

## 3. 컨텍스트 스위칭이 미치는 영향

### 캐시 오염 (Cache Pollution)

- 컨텍스트 스위칭이 발생하면, 이전 프로세스의 데이터가 CPU 캐시에 남게 된다.
- 새롭게 실행되는 프로세스 입장에서는 필요한 정보가 캐시에 없을 가능성이 높아진다.
- 결국 캐시 미스(cache miss)가 발생하고, CPU는 느린 메인 메모리에서 데이터를 다시 불러와야 한다.
- 이로 인해 시스템 성능이 저하된다.

### 캐시의 특성

- 캐시는 CPU가 자주 사용하는 데이터를 임시 저장하는 고속 메모리이다.
- 메인 메모리보다 용량이 작으며, 모든 프로세스가 함께 공유하여 사용한다.
- 하나의 프로세스가 사용하던 캐시 데이터를 다른 프로세스가 덮어쓸 수 있다.
- 따라서 컨텍스트 스위칭이 자주 발생할수록 캐시 오염 현상이 심해지고, 전체적인 성능 저하로 이어질 수 있다.

---

### 참고자료

[컨텍스트 스위칭](https://s7won.tistory.com/11#2.%20%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8%20%EC%8A%A4%EC%9C%84%EC%B9%AD%EC%9D%B4%20%EC%9D%BC%EC%96%B4%EB%82%98%EB%8A%94%20%EA%B3%BC%EC%A0%95-1)